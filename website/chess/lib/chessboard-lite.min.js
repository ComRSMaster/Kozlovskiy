!function(){"use strict";let e="abcdefgh".split(""),t=e.slice().reverse(),n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",r=300,l=200,o=80,i=80,a=100;function s(e){let t=(e=function(e){return e.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}(e=e.replace(/ .+$/,""))).split("/");if(8!==t.length)return!1;for(let e=0;e<8;e++)if(8!==t[e].length||-1!==t[e].search(/[^kqrnbpKQRNBP1]/))return!1;return!0}function c(e){let t=e.split("");return"w"===t[0]?t[1].toUpperCase():t[1].toLowerCase()}function d(t){if(!s(t))return!1;let n=(t=t.replace(/ .+$/,"")).split("/"),r={},l=8;for(let t=0;t<8;t++){let i=n[t].split(""),a=0;for(let t=0;t<i.length;t++)if(-1!==i[t].search(/[1-8]/)){a+=parseInt(i[t],10)}else{r[e[a]+l]=(o=i[t]).toLowerCase()===o?"b"+o.toUpperCase():"w"+o.toUpperCase(),a+=1}l-=1}var o;return r}function p(t,n){let r=t.split(""),l=e.indexOf(r[0])+1,o=parseInt(r[1],10),i=n.split(""),a=e.indexOf(i[0])+1,s=parseInt(i[1],10),c=Math.abs(l-a),d=Math.abs(o-s);return c>=d?c:d}function u(t,n,r){let l=function(t){let n,r=[];for(n=0;n<8;n++)for(let l=0;l<8;l++){let o=e[n]+(l+1);t!==o&&r.push({square:o,distance:p(t,o)})}r.sort(function(e,t){return e.distance-t.distance});let l=[];for(n=0;n<r.length;n++)l.push(r[n].square);return l}(r);for(let e=0;e<l.length;e++){let r=l[e];if(r in t&&t[r]===n)return r}return!1}window.Chessboard=function(p,f){let m=document.getElementById(p),h={};h.config=f;let g,C,y=!1,v=null,w=null,q=null,P=null,b=null,x={},E=16,N={};function z(e,t,n,r){let l=M(t);e.style.zIndex="1500",e.animate({transform:l},{duration:n,easing:"ease"}).onfinish=(()=>{e.style.transform=l,e.style.removeProperty("z-index"),"function"==typeof r&&r()})}function k(e,t,n){let l=function(e){let t=document.createElement("square");return t.className="piece",t.dataset.piece=e,t}(t);l.style.transform=M(e),l.style.opacity="0",x[e]=l,m.appendChild(l),l.animate({opacity:"1"},{duration:r,easing:"ease",delay:n}).onfinish=(()=>l.style.removeProperty("opacity"))}function S(e){let t=x[e];t.animate({opacity:"0"},{duration:a,easing:"ease"}).onfinish=(()=>{m.removeChild(t)})}function M(t){let n,r;return"w"===f.color?(n=e.indexOf(t[0]),r=8-t[1]):(n=7-e.indexOf(t[0]),r=t[1]-1),`translate(calc(${n} * var(--square-size)), calc(${r} * var(--square-size)))`}function O(t,n){let r=Math.floor((t-m.offsetLeft)/E),l=Math.floor((m.offsetTop-n)/E)+9;return 0<=r&&r<8&&0<l&&l<9?"w"===f.color?e[r]+l:e[7-r]+(9-l):"offboard"}function I(e,t){if(y)!function(e,t,n){e.style.transform=`translate(${t}px, ${n}px)`}(v,e-E/2-m.offsetLeft,t-E/2-m.offsetTop);else{let n=O(e,t);b!==n&&P.hidden&&(h.clearCircles(),n in x&&x[n].dataset.piece[0]===f.color&&f.onMouseoverSquare(n)),b=n}}function $(e,t){y&&(f.onDrop(w,O(e,t)),b=null)}return h.init=((n,r)=>{if(void 0!==f.color&&f.color!==r){let t={};for(let n in x)t[e[7-e.indexOf(n[0])]+(8-parseInt(n[1]))]=x[n];x=t}f.color=r,void 0!==g&&(g.remove(),C.remove()),(g=document.createElement("div")).className="files",(C=document.createElement("div")).className="ranks";for(let n of"w"===r?e:t){let e=document.createElement("b");e.innerText=n,g.appendChild(e)}m.appendChild(g);for(let e=8;e>0;e--){let t=document.createElement("b");t.innerText=("w"===r?e:9-e).toString(),C.appendChild(t)}m.appendChild(C),h.position(n)}),h.clear=(()=>{h.position({})}),h.fen=(()=>(function(t){let n="",r=8;for(let l=0;l<8;l++){for(let l=0;l<8;l++){let o=e[l]+r;n+=o in t?c(t[o].dataset.piece):"1"}7!==l&&(n+="/"),r-=1}return n=function(e){return e.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(n)})(x)),h.position=(e=>{null===e?e=d(n):s(e)&&(e=d(e)),h.clearCheck(),function(e,t){let n,r={},o=JSON.parse(JSON.stringify(t));for(n in e)e[n].dataset.piece!==t[n]&&(r[n]=e[n].dataset.piece),n in t&&e[n].dataset.piece===t[n]&&delete o[n];for(n in o){let e=u(r,o[n],n);if(e){n in r&&(S(n),delete r[n]);let t=x[e];x[n]=t,delete x[e],z(t,n,l),delete r[e],delete o[n]}}for(n in r)S(n),delete x[n];let i=0;for(n in o)k(n,o[n],i),i+=10,delete o[n]}(x,e),P.hidden?"ontouchstart"in document.documentElement||f.onMouseoverSquare(b):f.onMouseoverSquare(w)}),h.resize=(()=>{E=m.offsetWidth/8,document.documentElement.style.setProperty("--square-size",`${E}px`)}),h.start=(()=>{h.position(null)}),h.setCheck=(e=>{(q=document.createElement("square")).className="check",q.style.transform=M(e),m.appendChild(q)}),h.clearCheck=(()=>{null!==q&&m.removeChild(q),q=null}),h.addCircle=(e=>{if(e in N)return;let t=document.createElement("square");t.className=e in x?"dest eat":"dest",t.style.transform=M(e),m.appendChild(t),N[e]=t}),h.clearCircles=(()=>{for(let e in N)m.removeChild(N[e]);N={}}),h.snapbackDraggedPiece=(()=>{y=!1,z(v,w,o)}),h.dropDraggedPieceOnSquare=((e,t)=>{y=!1,P.hidden=!0,b=e,h.clearCircles(),e in x&&S(e),x[e]=x[w],delete x[w],z(v,e,i,f.onSnapEnd),h.position(t)}),(P=document.createElement("square")).className="selected",P.hidden=!0,m.appendChild(P),h.resize(),document.addEventListener("touchstart",function(){},!0),window.onpointerdown=(e=>(function(e,t){if(!f.draggable)return;y&&h.snapbackDraggedPiece(),I(e,t);let n=O(e,t);if(P.hidden||w===n||(n in x&&x[n].dataset.piece[0]===f.color?(h.clearCircles(),f.onMouseoverSquare(n)):(y=!0,$(e,t))),!(n in x))return h.clearCircles(),void(P.hidden=!0);let r=x[n];r.dataset.piece[0]===f.color&&0===r.getAnimations().length&&(y=!0,v=r,w=n,r.style.zIndex="1500",P.hidden=!1,P.style.transform=r.style.transform,I(e,t))})(e.pageX,e.pageY)),window.onpointermove=(e=>I(e.pageX,e.pageY)),window.onpointercancel=window.onpointerup=(e=>$(e.pageX,e.pageY)),window.onresize=h.resize,m.oncontextmenu=(e=>e.preventDefault()),h}}();
